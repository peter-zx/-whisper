<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Whisper æœ¬åœ°è¯­éŸ³è¯†åˆ«</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 30px auto; padding: 20px; }
    input, select, button { width: 100%; padding: 10px; margin: 8px 0; box-sizing: border-box; }
    button { background: #2196F3; color: white; border: none; cursor: pointer; }
    button:hover { opacity: 0.9; }
    .result { margin-top: 20px; padding: 15px; background: #eef7ff; border-left: 4px solid #2196F3; }
    #status { color: #d32f2f; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ™ï¸ Whisper è¯­éŸ³è¯†åˆ«ï¼ˆæœ¬åœ°ç¦»çº¿ç‰ˆï¼‰</h2>
  
  <input type="file" id="audioFile" accept="audio/*" />
  
  <select id="language">
    <option value="">è‡ªåŠ¨æ£€æµ‹è¯­è¨€</option>
    <option value="en">English</option>
    <option value="zh">ä¸­æ–‡</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="ko">í•œêµ­ì–´</option>
    <option value="es">EspaÃ±ol</option>
    <option value="fr">FranÃ§ais</option>
  </select>
  
  <select id="task">
    <option value="transcribe">è½¬å½•ï¼ˆåŸæ–‡ï¼‰</option>
    <option value="translate">ç¿»è¯‘æˆè‹±æ–‡</option>
  </select>
  
  <button onclick="transcribe()">ğŸš€ å¼€å§‹è¯†åˆ«</button>
  <div id="status"></div>
  <div id="result" class="result" style="display:none;"></div>

  <script>
    async function transcribe() {
      const file = document.getElementById('audioFile').files[0];
      const lang = document.getElementById('language').value;
      const task = document.getElementById('task').value;
      const status = document.getElementById('status');
      const resultDiv = document.getElementById('result');

      status.textContent = "";
      resultDiv.style.display = "none";

      if (!file) {
        status.textContent = "âš ï¸ è¯·é€‰æ‹©ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶";
        return;
      }

      const formData = new FormData();
      formData.append('audio', file);
      if (lang) formData.append('language', lang);
      formData.append('task', task);

      status.textContent = "â³ æ­£åœ¨è¯†åˆ«...ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’ï¼‰";

      try {
        const res = await fetch('http://localhost:8000/transcribe', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.error) throw new Error(data.error);

        resultDiv.innerHTML = `<strong>è¯­è¨€: ${data.language} | ä»»åŠ¡: ${data.task}</strong><br>${data.text}`;
        resultDiv.style.display = "block";
        status.textContent = "âœ… è¯†åˆ«å®Œæˆï¼";
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ é”™è¯¯: " + err.message;
      }
    }
  </script>
</body>
</html>